import React,{useEffect,useState} from 'react'; import API from '../api'; export default function MessageList({classId}){ const [msgs,setMsgs]=useState([]); const [loading,setLoading]=useState(true); useEffect(()=>{ if(!classId)return; setLoading(true); API.get(`/classes/${classId}/messages`).then(r=>setMsgs(r.data||[])).catch(()=>setMsgs([])).finally(()=>setLoading(false)); },[classId]); const markRead=async(id)=>{ try{ await API.post(`/messages/${id}/read`); setMsgs(ms=>ms.map(m=>m.id===id?{...m,read_at:new Date().toISOString()}:m)); }catch(err){} }; if(loading) return <div className='card'>Loading messages…</div>; if(!msgs.length) return <div className='card small-muted'>No messages yet.</div>; return (<div>{msgs.map(m=> (<div key={m.id} className='card' style={{marginBottom:10}}><div style={{display:'flex',justifyContent:'space-between'}}><div><div style={{fontWeight:700}}>{m.subject|| (m.body.length>60?m.body.substring(0,60)+'…':m.body)}</div><div className='small-muted'>From: {m.sender_name} — {new Date(m.created_at).toLocaleString()}</div></div><div style={{textAlign:'right'}}>{m.read_at? <span className='small-muted'>Read</span>: <button onClick={(e)=>{e.stopPropagation(); markRead(m.id)}} className='btn btn-ghost'>Mark read</button>}</div></div><div style={{marginTop:10,whiteSpace:'pre-wrap'}}>{m.body}</div></div>))}</div>); }