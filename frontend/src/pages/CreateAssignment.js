import React,{useEffect,useState} from 'react'; import API from '../api'; import { useParams, useNavigate } from 'react-router-dom'; export default function CreateAssignment(){ const { id } = useParams(); const navigate = useNavigate(); const [title,setTitle]=useState(''); const [desc,setDesc]=useState(''); const [due,setDue]=useState(''); const [students,setStudents]=useState([]); const [selected,setSelected]=useState(new Set()); const [assignAll,setAssignAll]=useState(true); useEffect(()=>{ if(!id) return; API.get(`/classes/${id}/roster`).then(r=>setStudents(r.data.filter(s=>s.role==='student'))).catch(()=>setStudents([])); },[id]); function toggle(uid){ const s=new Set(selected); if(s.has(uid)) s.delete(uid); else s.add(uid); setSelected(s); if(s.size>0) setAssignAll(false); } async function submit(e){ e.preventDefault(); const payload={ title, description:desc, due_date: due || null, total_points:100 }; if(!assignAll) payload.target_student_ids = Array.from(selected); await API.post(`/assignments/class/${id}`, payload); navigate(`/class/${id}`); } return (<div className='center-container'><h2>Create Assignment</h2><form onSubmit={submit} className='card' style={{maxWidth:720}}><div><label>Title</label><input value={title} onChange={e=>setTitle(e.target.value)} className='w-full p-2 border rounded' required /></div><div><label>Description</label><textarea value={desc} onChange={e=>setDesc(e.target.value)} className='w-full p-2 border rounded' rows={6} /></div><div style={{display:'flex',gap:12,alignItems:'center'}}><div style={{flex:1}}><label>Due date</label><input type='datetime-local' value={due} onChange={e=>setDue(e.target.value)} className='w-full p-2 border rounded' /></div></div><div style={{marginTop:12}}><label>Assign to</label><div><label><input type='checkbox' checked={assignAll} onChange={e=>{ setAssignAll(e.target.checked); if(e.target.checked) setSelected(new Set()); }} /> <span style={{marginLeft:8}}>Entire class</span></label></div>{!assignAll && (<div style={{marginTop:12,maxHeight:200,overflow:'auto',border:'1px solid rgba(0,0,0,0.05)',padding:8,borderRadius:8}}>{students.map(s=>(<label key={s.id} style={{display:'flex',alignItems:'center',gap:8,padding:'6px 0'}}><input type='checkbox' checked={selected.has(s.id)} onChange={()=>toggle(s.id)} /><div><div style={{fontWeight:600}}>{s.name}</div><div className='small-muted'>{s.email}</div></div></label>))}</div>)}</div><div style={{marginTop:12}}><button className='btn btn-primary' type='submit'>Create & Assign</button></div></form></div>) }
